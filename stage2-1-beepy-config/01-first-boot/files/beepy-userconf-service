#!/bin/sh -e

# Run initial setup
/usr/lib/userconf-pi/userconf-service

# Enable autologin
FIRST_USER="$(getent passwd 1000 | cut -d: -f1)"
cat > /etc/systemd/system/getty@tty1.service.d/autologin.conf << EOF
[Service]
ExecStart=
ExecStart=-/sbin/agetty --autologin $FIRST_USER --noclear %I \$TERM
EOF

# Add user to beepy HW group
groupadd beepy ||:
usermod -aG beepy $FIRST_USER

# Add quiet flag to cmdline
sed -i 's/rootwait/quiet rootwait/' \
	/boot/firmware/cmdline.txt

systemctl daemon-reload ||:
systemctl disable raspi-config

reboot
